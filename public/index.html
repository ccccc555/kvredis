<!DOCTYPE html>
<html>
<body>
  <canvas id="canvas"></canvas>
  <script>
    const c1 = document.getElementById('canvas');
    const ct1 = c1.getContext('2d');

    // Set canvas dimensions
    c1.width = 700;
    c1.height = 900;
var name=prompt("Enter name")
var xp,yp, namlen=0
var names=[]
var proc, d=0
 
function posi(){
  ct1.clearRect(0,200,600,400)
    navigator.geolocation.getCurrentPosition((position) => {
   yp=position.coords.latitude
   xp=position.coords.longitude
      ct1.fillText(name, 360+3*xp,300-3*yp)
      ct1.fillText(xp+"/"+yp,200,40)   
      
      setTimeout(sv,10)
});


}
    
function ky(){
 const option = { method: 'GET', }  
 fetch("/getkeys",option )
     .then(response => response.json())
     .then(response => {
     namlen=response.le
      for(var j=0; j<namlen; j++){
        names[j]={name: response.ks[j], x:0 , y: 0}
        ct1.fillText(names[j].name,0,200+35*j)
        
        }
       d=0
       proc=setInterval(disp,800)
       } )
      .catch(err => {alert('keys err='+err)}); 
                        
}
 
function disp(){
 if (d>=namlen){clearInterval(proc); return}
 dy(d)
 d++
}

function dy(id){
  var opts= { method: 'POST', body: JSON.stringify({word: names[id].name}) }                
            
   fetch("/getname", opts)
   .then(response => response.json() )
   .then(response => { names[id].x=response.x
                       ct1.fillText(names[id].x,200,200+35*id) }
            )
   .catch(err => {alert('disp err'+err) })
}
    
function sv(){
  const option= { method: 'POST', body: JSON.stringify({word: name, x: xp, y: yp } ) }
  fetch("/setname",option )
  //.then(response => response.json() )
  //.then(response => { alert('newset') } )
  .catch(err => {alert('newerr'+err)} )
}       
  
    
           
ct1.font="40px Arial"
ct1.fillText("Test14",0,90)
    
   setTimeout(posi,100) 
 setInterval(ky,9000)

 
    
    
  

    
  
  
  
  
    </script>
  </body>
 </html>







