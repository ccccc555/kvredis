<!DOCTYPE html>
<html>
<body>
  <canvas id="canvas1" width="1000" height="1000" style="position: absolute; left:0; top:0; z-index:0;"></canvas>
  <canvas id="canvas2" width="1000" height="1000" style="position: absolute; left:0; top:0; z-index:1;"></canvas>
  
  <script>
    const c1 = document.getElementById('canvas1');
    const ct1 = c1.getContext('2d');
    const c2 = document.getElementById('canvas2');
    const ct2 = c2.getContext('2d');

    // Set canvas dimensions
    c1.width = 1100
    c1.height = 1300
    ct1.fillStyle='#FF9999'
    ct1.fillRect(0,0,1050,1250)
    ct1.fillStyle='black'
    ct2.font="40px Arial"
    ct2.fillText('FindU',500,850)
    var img=new Image()
    img.onload = function(){
      ct2.drawImage(img,0,0,1000,600)
      }
    img.src="IMG_1564.avif"
var name=prompt("Enter name")
var xp,yp, namlen=0
var names=[]
var proc, d=0,ups=0
 
function posi(){
  ct1.clearRect(0,700,1000,200)
    navigator.geolocation.getCurrentPosition((position) => {
   yp=position.coords.latitude
   xp=position.coords.longitude
      ct1.fillText(name, 360+3*xp,300-3*yp)
      ct1.fillText(xp+"/"+yp,200,760)   
      
      setTimeout(sv,10)
});


}
    
function ky(){
 const option = { method: 'GET', }  
 fetch("/getkeys",option )
     .then(response => response.json())
     .then(response => {
     namlen=response.le
      for(var j=0; j<namlen; j++){
        names[j]={name: response.ks[j], x:0 , y: 0}
      //  ct1.fillText(names[j].name,0,370+38*j)
        
        }
       d=0
       ct1.clearRect(0,300,1000,700)
   ups++
  ct1.fillText('updates='+ups,10,330)
   
       proc=setInterval(disp,500)
       } )
      .catch(err => {alert('keys err='+err)}); 
                        
}
 
function disp(){
 if (d>=namlen){clearInterval(proc); return}
 dy(d)
 d++
}

function dy(id){
  var opts= { method: 'POST', body: JSON.stringify({word: names[id].name}) }                
            
   fetch("/getname", opts)
   .then(response => response.json() )
   .then(response => { names[id].x=response.x
                       names[id].y=response.y
                       ct1.fillText(names[id].name +' = '+names[id].x+' / '+names[id].y,200,370+38*id) }
            )
   .catch(err => {alert('disp err'+err) })
}
    
function sv(){
  const option= { method: 'POST', body: JSON.stringify({word: name, x: xp, y: yp } ) }
  fetch("/setname",option )
  //.then(response => response.json() )
  //.then(response => { alert('newset') } )
  .catch(err => {alert('newerr'+err)} )
}       
  
    
           
ct1.font="40px Arial"
run()  
function run(){
   posi()
  setTimeout(ky,3000)
  setTimeout(run,7000)
 }
      

 
    
    
  

    
  
  
  
  
    </script>
  </body>
 </html>







